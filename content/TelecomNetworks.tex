

\section{Telecommunication Networks - Transport Networks}

From the courses Internet Networks and Services (RSI in portuguese) and Telecommunication Networks (RTel in pt) I've had an insight about how the whole network is multiplexed into optic fibers and many other interesting topics such as the triple play services and a bunch of protocols that are used in today's world to make everything communicate with everything. Therefore, I propose to write a sum up of the slides and bibliography of RSI and RTel in this section. I'll mainly give importance to RTel since it is what I'm studying at the moment, but I hope to go through the slides of RSI as well.

\begin{multicols}{2}
\begin{enumerate}
    \item Introduction \\(2 lessons)
    \item Fundamentals of networks \\(7 lessons)
    \item Ethernet and data centre networks \\(5 lessons)
    \item SDH transport networks \\(4 lessons)
    \item Optical transport networks \\(4 lessons)
    \item Access networks \\(3 lessons)
\end{enumerate}

\columnbreak

\begin{enumerate}
    \item The Internet
    \item Quality of Service on the Internet
    \item IP Network Models
    \item Next Generation Networks
    \item The Telephony Network
    \item Technologies for data transport
    \item MPLS - Multi-Protocol Label Switching
\end{enumerate}
\end{multicols}

\subsection{Introduction}

\bb{Definition}\hspace{-.2cm} \ii{Telecommunications}:  is the transmission of information at a distance through the use of electromagnetic signals.

\defining{Telecom. Network} collection of nodes and links with the purpose of interchanging these signals in order to have an information flow.

These Telecommunication Networks can be public, owned by Telecom. / Network Operators that use that network to provide services to the general public, or can be private, used by a company to connect infrastructures. Many of these private networks also rely on leased links by public networks.

There are mainly 3 layers in a network: the backbone or core, the metropolitan and the access layer. As expected, the access layer collects the traffic, connections to homes, offices, everywhere the internet is required. The metropolitan area connects different parts of the city that use that network, typically with a ring (made out of optic fiber). The core is the most extensive layer, with a mesh of nodes and very extensive links that connect cities of the whole world. Hundreds or thousands of km's is not atypical.

What makes possible to communicate with everyone connected to the internet is that the networks of both operators are also connected.

As a public service, the public networks must provide fidelity (transmit the information without loss of changes) and reliability (less than 3 minutes down per year).


\vspace{.5cm}

Nowadays, most of transmission is digital. A series of pulses is transmitted through a channel with attenuation, dispersion, interference from other signals and noise. Therefore what reaches the other side is considerably different and has to be estimated what the original input was.

\quickimage{RTel/Cap1-001.png}{0.9}

As having a dedicated physical infrastructure for each service would be far to expensive and messy, the big majority of services share the same channel, the optic fiber. It is easily shared because of the available bandwidth in it. Thus, the signals are multiplexed at the entrance, using different wavelengths (\bb{Wavelength-Division Multiplexing (WDM)}) and de-multiplexed at the other end, to follow each one to their device that is requiring the service. 

Note that WDM is exactly like \bb{Frequency Division Multiplexing (FDM)} but in the optical domain. Technically they are exactly the same as changing the wavelength is nothing more than changing the transmit frequency.

A single mode optical fiber can reach throughputs of 10 Terabits per second.

Remember that there are many ways of scheduling frames in a multiplexer. With time slots or doing it statistically are two ways. Also, there are 2 types of switching: packet switching and circuit switching. Circuit is when a channel is constantly reserved for a certain application even if it is not being used. Packet switching allows a much better share of the resources. Packet switching principle is based on sending packets whenever there's a packet to transmit and use all the resources to do so as fast as possible. Therefore, the "speed" of the internet depends a lot on the amount of people that are accessing it. 

Regarding the physical infrastructures for the transmission of data, those go from satellites, well the open space in general as microwave links are also a thing, twisted pairs, optical fibers and even a few more that are less common.

Finally, a look at the tendencies is pertinent. The traffic is increasing constantly, at a rate of 30\% a year, therefore the network must be upgraded as the time passes as well, or else it won't be able to handle the traffic of the future. Not only are the links being upgraded since now we have fiber to the home, terminating really in our router, but each node must be upgraded as well to cope with the traffic resulting in new switches, larger datacentres, ect... However, all of this must be standardised to guarantee compatibility between countries, operators, manufacturers and users and to ensure minimum quality of service for all users. This standardisation is done by the International Telecommunication Union (ITU) that has two main sectors of interest: the -T sector regarding telecommunications in general and the -R sector for radiocommunications that is more focused in point-to-point, mobile, satellite links, ect\dots Additionally, ETSI, ISO, OSI, ANSI, IEEE are some of the main organisations that standardise technologies. IEEE is the best :)



\subsection{Networks Fundamentals}

A network is composed of nodes and links and can be represented by graphs.
However, a clear distinction between networks and graphs has been made in class: a network is a graph with a few more numbers that represent various network parameters. These parameters will be talked later, but can be delay of a link, distance, \dots


The physical topology concerns the physical connections that are in place while the logical topology for a certain case concerns the actual flow of information. Even though every computer is connected in a network, maybe the information always flows from one to the others and the graph that represents that has much less links.


A link can be unidirectional or bidirectional. If the link is unidirectional, sometimes is referred to as an arc. $e_1 = (v_1,v_2)$ is the representation of a link, and the order of the nodes matter if it's an arc.

In optical fiber networks, or other networks that require amplifiers, the space between amplifiers (distance the signal has to go attenuating) is called a span.


\quickimage{RTel/Cap2-001.png}{.5}

In a graph there's N number of Vertices($v_i$), and L number of Edges($e_j$). And the degree of the vertex is the number of edges it has.
It's called the order of the graph, it's number of vertices, and the size of the graph it's number of edges.

Directed graphs only have unidirectional links, while undirected graphs only have bidirectional links.

\bb{The reason to make the distinction between directed and undirected graphs}(unidirectional and bidirectional edges): in case of optical fiber, which is what connects most of long distance networking, is required to use more than one fiber. Because and optical emitter can't receive as well (at least in the same fiber). 
Also, if amplifiers are required, note that they are directed as well.

A path can be represented by a set of links, starting at some node. Source and sink are the names for the first and last vertex of that path.

\subsubsection{Network Topologies}

\quickimage{RTel/Cap2-002.png}{.5}


Bus, Ring and Star are the main physical topologies. Tree as well.

A tree is simply a graph with no cycles.

\subsubsection{Network representative Matrices}

A graph can be represented with an \bb{Adjacency matrix (A)}, with $a_{ij} = 1$ if there's a direction from the vertices i to j.

The average node degree is given by the average of each node's degree which won't be more than the sum of all links, times 2 divided by the number of nodes. Times 2 because each link contributes for the degree twice, once at each end.

\quickimage{RTel/Cap2-003.png}{.5}


The Network diameter ($D_R$) is the maximum number of links between nodes through the shortest path between them. $D_R$ is the longest of the shortest paths between every node.


Every link can have an associated cost (a function of distance, delay, reliability, actual cost, or other parameters) and a capacity ($u_e$ denotes the capacity of node $e$).

\quickimage{RTel/Cap2-004.png}{.5}


Despite similar to an Adjacency Matrix, the \bb{Demand matrix (D)} is slightly different. $d_{ij} = 1$ if the traffic flows from the vertex i to the vertex j.

Note that the diagonal of this matrix should be empty, or else it would mean that a certain node would receive information from himself, which makes no sense.

The mean number of demands is the number of demands divided by the number of nodes.

\quickimage{RTel/Cap2-005.png}{.5}

The number of unidirectional demands (edges) in a case of full mesh logical topology is $D_1  = N (N-1)$. N nodes x the other N-1 nodes. Note that 
One other way of seeing it is that the D matrix is $N \times N$ but we need to take N away due to the empty diagonal. $D_2 = \frac{D1}{2}$ is the number of bidirectional demands, which is when only the top triangle of the D matrix is considered. This is usual because with bidirectional links the D matrix will always be symmetric.



Another interesting matrix is the \bb{Traffic matrix (T)} and it's used to denote traffic intensities. It only has entries different from 0 in the exact same places the Demand matrix has. It's used for static traffic designs.

\quickimage{RTel/Cap2-006.png}{.5}


Considering now a Dynamic Traffic case, a few concepts arise:
\begin{itemize}
    \item Average intensity of data flow between two nodes;
    \item Traffic bursts are time intervals where the flux of data is considerably higher than the average rate;
    \item Peak rate is the maximum instantaneous intensity.
\end{itemize}

Aggregation level or multiplexing level reduces the traffic \ii{burstiness} because there less often flows get fully used and is more likely that the information can flow at a constant pace instead of in bursts.


\bb{Note} one important distinction between Logical and Physical Topologies that we haven't done yet is that there can be many logical topologies on one physical topology. This can happen in the following way: 


\quickimage{RTel/Cap2-007.png}{.5}



\bb{Routing} is how a packet travels in a network. Therefore, routing ends up being the map between logical and physical topologies. 

In optical networks the path between two nodes is usually called ``lightpath''.

We can also define a \bb{Cost Matrix (C)} where each element $c_{ij}$ represents the costs between nodes i and j.

The path can be performed manually (static routing - Demand matrix is time invariable) or dynamically, through routing algorithms (dynamic routing - Traffic matrix is time dependent, with constant arrival and termination of new demands).

Additionally, if the a given traffic demand(connection) is able to use more than one route, it is called a multipath routing process, else it is a mono-path process. Because there are usually many paths connecting two nodes, some metrics are taken into account when choosing which to follow:

\quickimage{RTel/Cap2-008.png}{.5}


From the physical topology, described by a graph G(V,E) and the traffic matrix T, describing all the traffic demands to be routed, one can perform shortest path algorithms such as Dijkstra's algorithm.

\quickimage{RTel/Cap2-009.png}{.5}

\bb{Dijkstra's Algorithm}

\quickimage{RTel/Cap2-010.png}{.5}

Now is pertinent to introduce yet another matrix, the \bb{Hop Matrix (H)} where each element $h_{ij}$ denotes the minimum number of hops from node i to node j.

The average number of hops per demand is nothing more than the sum of the hops of all demands divided by the number of demands. The number of demands was set as the unidirectional links between two nodes. Therefore, if 2 nodes share information between themselves (don't need to have a physical link, a logical one is enough) then there's a demand. 

Therefore, the average number of hops can be computed:

\quickimage{RTel/Cap2-011.png}{.5}

Note that coherence is key here. If the amount of demands are the bidirectional demands, then the number of hops considered should only be the top half of the hop matrix. \bb{If links are bidirectional, then there will always be a symmetry in these matrices} and we should compute the average with amount that mean the same thing.


As means of simplifying this calculation, because hops and demands can be dynamic, a way of having a notion on the order of magnitude and get a fairly good approximation, when the number of nodes N is $4 \leq N \leq 100$ and the average node degree $<\delta>$ is $2.5 \leq  <\delta> \leq 5 $, is by computing the semi-empirical relation:

\quickimage{RTel/Cap2-012.png}{.5}



\subsubsection{Layers}

Typically, there's a layered structure in the network. The layer above acts as a client of the layer beneath and each layer appears a black box that supplies a service to the layer above.


The service layer is the one closer to us. 

\quickimage{RTel/Cap2-013.png}{.5}


\bb{Add/Drop Multiplexing(ADM)} are multiplexers controlled by \bb{Control Centres (CC)} that decide what to add and what to drop form the fibre. Note that these don't manage the network, they just use it.

Nowadays, apart from local networks, everything is connected with fibre. Therefore, is pertinent to mention 4 key technologies for transport networks:

\quickimage{RTel/Cap2-014.png}{.5}

SDH is also used in Hertzian links, MPLS is Multiprotocol Label Switching and is very useful for routing through different technologies and to choose more carefully the paths. As said above, OTN will be our transport technology.

OTN has become the new standard for a while now and has a few differences compared with SDH. The most important of which is distinction between fixed frame size and fixed rates. SDH has a fixed rate while OTN can increase it's rate to match the client's and this is very important for scalability and being more future proof

\bb{A very important distinction between the transport and the service layers} is that the representation in the service layer has nodes connected with \bb{logical topologies} while the transport layer has nodes connected with \bb{physical topologies}.

\quickimage{RTel/Cap2-015.png}{.5}

The network management systems sends configurations through the \bb{Data Communication Channel (DCC)}. Moreover, not all parts of the network are the same!

\quickimage{RTel/Cap2-016.png}{.5}


One important distinction in terms of how things are connected physically is evident comparing the access networks with the other parts of the network. Access Networks, as opposed to what happens to the rest of the network, uses twisted pair or one optic fiber. This is because of the cost versus the bandwidth a fiber offers. One fiber can carry several times the traffic of one user, therefore can be used for multiple users. Moreover, very often the final leg is done with twisted pair due to cost reasons.

In a more abstracted way, one can identify three planes:

\quickimage{RTel/Cap2-017.png}{.5}

As you already know, there are circuit switched or packet switched networks.

\bb{An important note:} Packet switching can be connection oriented (MPLS) or simply connectionless (pure IP packets, best effort)

Circuit Switched require circuit establishment and tear-down at the beginning and at the end, respectively. However, a distinction is made between physically \ii{switchable} circuits and semi-permanent circuits. The first ones, a physical circuit is easily switched to connect one end to the other, while the second type regards circuits that are more static, that are much more difficult to switch. The semi-permanent must be switched by the administrators in order to attribute these circuits to a user for a somewhat long period of time (not just one transmission).
\quickimage{RTel/Cap2-019.png}{.5}

\bb{The biggest difference is the amount of time each one uses de circuit for. Switched circuits is around minutes, Semi-permanent are months.}


Then, of course, there are packet switched networks that allow a much better share and efficient use of resources.

\bb{The key notion to have is that all services use the transport network! This is the highway of data! Nowadays it is impossible to have dedicated physical connections for each service. And this section of \ii{Networks - Transport Networks} is based on that!}



\subsubsection*{Telephone Networks}
Telephone Networks before used circuit-switching. Note that the only ones that use circuit-switching are the landlines! Nowadays, our mobile communications are able to replace this fixed circuits lines

Local exchanges (Access) - are small switching centres that serve a small area.

Transit exchanges(metro, core) occur in \bb{Primary trunk exchanges} is used to transfer the traffic and to interconnect several circuits.

They usually have a physical connection between them, but not one of their own. It wouldn't be viable to have dedicated circuits. It's here that the transport networks comes.

Different components have different topologies. The network is a hierarchy, having different topologies in different parts of the network.

Digital Circuit-switching meaning that the data being switched is of digital nature.



\subsubsection*{Hybrid Fibre-Cable Network}

There's an head end that distributes all the channels for all the users. 

The network is called hybrid because it uses both fibre and coaxial cable.


Excellent example of a tree network. Like all the networks with share mediums, it required multiple access protocols to allow everyone to use the medium (FDMA and TDMA are 2 of the multiple access technologies).


\quickimage{RTel/Cap2-020.png}{.5}

The transport network is represented by the optical fibre that connects the head head to the optical access node. Like the cellular communications, one optical access node covers a certain area, with coaxial cable.


\subsubsection*{IP Networks}

There are 2 ways of sending IP packets:

- Without Connection, it is necessary to have a buffer to reassemble all the IP packets. The packets are simply send to the network in a best effort way.

- With Connection: when certain QoS is required, then MPLS is used, so that certain resources can be reserved and the QoS met.
MPLS establishes a virtual circuit before starting transmitting the packets.
MPLS acts between layer 2 and layer 3. It places a label between the layer 2 and layer 3 labels.

There are 2 types of MPLS routers:
- LER - Label Edge Router are the ones that put the labels and take them out;
- LSR - Label Switching Router simply take labels out.

MPLS works by pre-establishing a path for information flow. Then, at each hop, according to the label id's available in each LSR the label arrives with one number and it leaves with other, based on the MPLS routing table in each MPLS capable router. This table entries are created based on the MPLS protocol and pre-path find procedures.


This is how a MPLS table looks like: 

\quickimage{RTel/Cap2-025.png}{.5}




Generalized MPLS (GMPLS) is the \ii{de facto} (practice that exists practically even though it is not formalized by law) of the control plane of the Wavelength Switched Optical Network (WSON).

Label Switching allows Traffic Engineering:

\quickimage{RTel/Cap2-024.png}{.5}



\subsubsection{Layered Model Overview}
Open Systems Interconnection Model:
\quickimage{RTel/Cap2-021.png}{.5}


Transport layer connects applications.
Network layer connects machines with different IPs.
Data link layer connects two machines with their interfaces' MAC addresses.
Physical layer is what is responsible for putting the data into a cable or into the air to perform the actual transmission. For instances, spectrum, modulation and coding techniques and intervals of transmission.




\quickimage{RTel/Cap2-022.png}{.5}

\quickimage{RTel/Cap2-023.png}{.5}




\subsection{Ethernet Networks}

Most of today's network traffic is generated from Ethernet interfaces. Made from twisted copper pair, through slightly more advance techniques and protocols is still possible to get quite a good throughput with a low cost cable.

Uses CSMA/CD Carrier-sense multiple access with collision detection because it can sense if there's anyone using the bus at all times. WiFi for instances CSMA/CA is used since we may be causing a collision we can't detect.

The Ethernet protocol 802.3 is used in all parts of the transport layer, not only at the access level and specially not only in LAN (Local Area Networks). Note that the Ethernet protocol was standardised by IEEE and the standard specifies not only the physical specifications but also Data Link Layer frame formats.
WiFi 802.11 is another protocol that includes physical, like transmit powers and modulations, and Data Link specifications 

A rule of thumb is to use optical cables for distances above 100 metres.

\quickimage{RTel/Cap3-001.png}{0.6}

\begin{itemize}
    \item The LLC (Logical Link Control) sub-layer is responsible
    for the flow and error control between the nodes.
    \item The MAC sub-layer is responsible for the media
    access control, addressing, error detection, frame
    delimitation, by organizing the bit sequences into
    frames.
    \item The physical layer deals with the bit transmission
    and reception, with the electrical, optical and
    mechanical properties of the interfaces, with the type
    of connectors used, etc.
\end{itemize}


The Data Link layer is responsible for frame processing, and error detection through the calculation of a CRC (Cyclic Redundancy Check). If a frame has errors, it is discarded.
Most of error correction is done higher up in the stack. TCP guarantees error free transmissions when it says they were successful.

MAC stands for Media Access Control. Thus, the MAC addresses are addresses to access the physical media. CSMA protocols are placed in this layer. 

There are 2 bits in the MAC address, the two least significant ones form the first octet.

\quickimage{RTel/Cap3-004.png}{.5}

U/L refers to the uniqueness of the interface. The MAC address can be changed becoming a local one. I/G refers to one interface only or a group that has that MAC address that received always the same thing. 

Write \ii{ifconfig} or \ii{ip a} in linux (or \ii{ipconfig} in windows) is possible to see this MAC address.


\quickimage{RTel/Cap3-002.png}{.5}


Because there are only 1500 bytes to address (to count) with the Length/Type field, then there will be quite a few empty bits in this field. The rest of the bits are used to denote the type of the frame: 


\quickimage{RTel/Cap3-003.png}{.5}


The purpose of the Preamble is to achieve clock synchrony.





\subsubsection{Multiple Access}

TDMA, FDMA (WDMA), CDMA all have the same principle: divide signals in a given domain. 

TDMA divides signals in the time domain: different transmissions occupy different time slots.

FDMA divides in frequencies, WDMA divides in wavelengths. The only difference is that one is more used in wireless applications and the other with fibres.



OFDMA starts combine the previous ideas: divides in the time and in the frequency domains, therefore is able to attribute resource blocks with much better efficiency. A use of OFDMA is in 4G and 5G where a physical resource block is nothing more than a set of sub-carriers used for a given time period, usually called one TTI (Transmission Time Interval).

CDMA is used in 3G and with GPS, so that different satellite can transmit all at the same time.

Then there's another category of multiple access techniques like CSMA. Namely CD and CA, collision detection and collision avoidance. 


Collision Detection is when a collision is possible to be detected and after being detected certain steps are taken to minimize the risk of happening again.

Collision Avoidance is when the collision can't be detected and should at all costs be avoided.

A curiosity: he speed of light inside an optical fibre, considering an average glass refractive index of 1.5, is:
\begin{equation}
    v = \frac{c}{n} = 2 \times 10^8 m/s
\end{equation}


In cabled Ethernet, CSMA/CD is used. Disregarding all other phenomena that limit the debit - dispersion that leads to distortion, attenuation, etc\dots - the use of CSMA/CD is limited by the distance that the information can travel before one discovers that a collisions as occurred. In essence, if the maximum debit is 10 Mbit/s and the maximum ethernet frame is around 1500 bytes long, it will take $\frac{1500 * 8 bits}{10 \times 10^6 bits/s} = 0.0012 s$. 

The electrical signals propagate at speed of light - don't confuse with the speed of light in the fibre, in the fiber the light is propagating in glass, here there's a wave propagating in TEM mode along a twisted pair or coaxial cable. Therefore, in order to notice a collision, the signal must be able to go all the way to the other end and comeback BEFORE the sender is ready to send another frame. Mathematically: $T_{max-frame} \geq 2 T_{propagation}$. This is because, if there is a collision at the other end, the sending machine must receive that collision before finishing the transmission, otherwise it would keep sending frames without knowing about the collision.

\quickimage{RTel/Cap3-006.png}{.5}

Since $T_{propagation}$ is proportional to the length of the connection, and the time of transmission is inversely proportional to the bit rate, then the bigger the rate, the smaller the maximum distance between machines can be. 

That is also why CSMA/CD is not used when the rates get too high!

\quickimage{RTel/Cap3-005.png}{.5}


Note that this is only necessary if a medium is shared! If it is dedicated, it is not necessary.


A switch is a layer 2 - the Link Layer - equipment that commutes Ethernet frames. 

\quickimage{RTel/Cap3-013.png}{.5}

\bb{A Hub only has physical layer, propagates to all interfaces everything. A Switch has layer 2 and Mac Address Tables. A Router has layer 3 capabilities and is able to route IP packets.}


Switches with higher capacities are higher up in the grid, closer to the core, because they have to handle many more traffic flows.

Some functions of switches:
\begin{itemize}
    \item Forwarding - Simply check the destination, it knows to which port that destination is connected to and send the frame in that port destination is 
    \item Broadcasting - Sending to all destinations, this happens when it doesn't know where to send it and needs to find out. 
    \item Filtering - 
\end{itemize} 

In order to avoid problems such as exponential spreading of frames, a \bb{Spanning Tree Protocol} at a logical level is used. Closed loops go away with this protocol since a tree is created and all notes still are connected since it is a spanning tree. BPDU - Bridge Protocol Data Units are the frames sent to establishing this tree.


Ethernet frames don't have time to live. But in BPDU's have TTL 


This Spanning Tree Protocol can be implemented in the following way:
\begin{enumerate}
    \item Root Switch election - typically the one that has the smallest MAC in the network because computing the one that has the smallest distance to every other node is too troublesome. Therefore, after receiving a BPDU with an ID lower than the current root, it replaces his belief of root and propagates that information.
    \item Convergence to Spanning tree starting at the Root - The root propagates BPDU's with a cost to root (if the root is sending, the cost is 0). The nodes that receive do the same: \bb{(root id, my id, cost to root)}. 
    - If the received packet tells a cost to root that is smaller than before, that port is designated as the root port. 

    - If the received packet tells a cost that is bigger, than that port will be blocked: not packets should be sent that way!

    - The ports that are not blocked and that will connect the lower nodes to the root will be called \bb{designated ports}. These are the ports that node can send things to.                                                                                                                                                                                                                                                                                                    
\end{enumerate}


This is an example of the status of each 
\quickimage{RTel/Cap3-007.png}{.5}




\ul{How is the switch able to build the Source Address Table (SAT)}

It can be filled by hand, by the network administrator. Or it can learn the MAC that communication to each port.




\begin{center}
    \bb{How packets Travel in the network}
We write a message in the phone or in the laptop and press send in the application (layer). First, there is some compression and encryption done by the application layer right away. Then in the application code, there is a section that is defining TCP or UDP sockets - very likely TCP - 
%CONTINUEEEEEEEEEEEE

\end{center}


\ul{How to build minimum spanning trees?}
They are needed for the spanning tree algorithms like the Link Layer LAN minimum spanning tree algorithm.

With the Kruskal's Algorithm: %is it really?
\begin{enumerate}
    \item order the edges by their cost, minimum first.
    \item keep adding edges to a the spanning tree, as long as the edge doesn't create a loop (connects two nodes already connected in another way).
    \item stop when the tree has \bb{n - 1} edges.
\end{enumerate}





\subsubsection{Physical Layer of the Ethernet}

The Ethernet protocol includes physical specifications.

Between the link layer and the physical layer (the layer right before the physical medium) there's a \bb{medium independent interface (MII)}. In the picture below, depending on the debits being transmitted, this interface has several names. It has different names because it is a parallel interface that depends on the debit.


\quickimage{RTel/Cap3-008.png}{.5}

The first sublayer of the physical layer is coding. It will had signals to the bits. Each bit will 

The second sublayer is responsible for the parallel/series conversion.

The last sublayer must generate the signal into the medium being optic fibre, twister pair, etc...

In essence:

\quickimage{RTel/Cap3-017.png}{.5}




\subsubsection*{Code - mBnB}

Firstly, the code. Required for robustness of transmission and to send symbols at lower frequencies than the actual bitrate.

\bb{m input, n output bits}



By switching between Mode 1 and Mode 2, the number of 0's is identical to the number of 1's, which is important to keep the stochastic balance between 1's and 0's - important for detection.
\quickimage{RTel/Cap3-010.png}{.5}



After the coding, a 1Gbit/s bit rate is converted into a $\frac{n}{m} * Rate$. For 3B4B, it will be necessary to transmit 4 bits in the time it took to transmit 3. Before, the rate per bit would be $\frac{1Gbit/s}{3}$. And this needs to be multiplied by 4 to have the 4 bits going at the same time. Therefore, 1.(3) Gbaud (symbols per second) is the new rate.



The ethernet transmission is done in baseband, no modulation.

\quickimage{RTel/Cap3-009.png}{.5}

For the correct names \href{https://en.wikipedia.org/wiki/Ethernet_physical_layer}{\ul{Ethernet phy layer}}.


\subsubsection*{Avoiding Crosstalk}
Electromagnetic interference becomes a limiting problem in very high frequencies.
To reduce these interferences, a metal sheet foil can be used. A more effective solution is really to use a shield 
Therefore, shielding is necessary for twisted pairs.


The necessary bandwidth to transmit 10Gbaud/s.

1 baud can have several bits of significance, therefore there is a strong leverage in the coding that is used.

\bb{COMPLEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEETE THIIIIIIIIIIIIIIIIIIS}

\quickimage{RTel/Cap3-011.png}{.5}


In order to multiplex everything into the physical medium, there are two ways of doing it, normally the second one is used.
\quickimage{RTel/Cap3-015.png}{.5}


\quickimage{RTel/Cap3-014.png}{.5}


\subsubsection*{Gigabit + Ethernet}
When the speeds are too big, either the distances need to be smaller or fibres must be used. Single mode avoids dispersion and the pulse is able to keep is form for longer.



\subsubsection{Virtual LAN}
The time it would take to implement the Spanning Tree Protocol in very big networks makes it infeasible. Therefore, the same physical grid should be separated in many logical grids and the spanning tree only covers one VLAN.


VLANs also allows for traffic separation in triple play services, allow for cloud computing and storage separation. Is possible to separate departments, buildings, etc\dots



Additionally, it improves the network security and privacy since the traffic inside a VLAN doesn't need to come outside. And facilitates network management since the administrator is able to organize user groups independently of the physical topology of the network. It is the network administrator that defines the limits/boundaries of the VLAN. 

\bb{The communication between VLANs is done at Layer 3.}

There is 3 types of VLANs implementations:
\begin{itemize}
    \item Layer 1 VLAN (port-based VLAN): the frames don't need to be tagged and the switch distinguish VLANs based on the ports it come from.
    \item Layer 2 VLAN (MAC Address-based VLAN): the frames need to have VLAN specific tag.
    \item Layer 3 VLAN (Network Address-based VLAN): The information of VLAN includes IP addresses, requires routers.
\end{itemize}


Here is the tag:
\quickimage{RTel/Cap3-016.png}{.5}

Note the first field of the tag is bigger than 1500. This happens because the switch is expecting to see a Length/Type field. This way, the switch reads it as a type that is a VLAN type and it knows how to treat the frame - that can be a BPDU or any other kind of frame - based on that identifier.

There is 2 octects to identify the VLANs (4094 because 2 are reserved). At some point, it isn't enough. What is done is multiple tagging: \bb{simply by adding another tag, a  VLAN inside a VLAN is created}.
However, VLAN IEEE802.1Q is not very clear on how to treat such encapsulations, thus IEEE802.1ad Provider Bridges is used. The tag is called a Service Provider Tag and requires a Provider Bridges aware switch.

A switch can be aware to simple untagged frames, can be aware of VLANs and can be aware of Provider Bridges.

However, with these 2 tags, tables with 16 Million entrances is already too big\dots \bb{There must be another way of scale the network properly and way of connecting PB switches at long distances.}

\bb{Solution 1- }
Ethernet doesn't have regenerators, therefore the ethernet frame can be place inside a transport network frame. Using SDH or OTN there's regeneration and there can be links with more than 40 km (the maximum length without regeneration).

\quickimage{RTel/Cap3-018.png}{.5}


Carrier Ethernet is the idea of using Ethernet in all of the network.

PB switches are barely capable of handling Metro, can't be used in the core.
PBB switches are the ones used in the core and they only process their own headers.

\bb{However, this is quite far from Ethernet Networks and requires many more functions to compete with the transport network}

The standard of the transport network is recovering links after a failure in less than 50 ms. OAM functions and much more is needed to be implemented in Ethernet protocols in order to provide reliable traffic.

But, there's a huge Ethernet frame...

\quickimage{RTel/Cap3-020.png}{.5}


And they then it still uses spanning tree protocols? Non deterministic networks in the core? This would lead to big delays every time there's a change in a link 

It is necessary to establish hard links through the management plane.

PBB-TE is a variation of PBB that doesn't use the spanning tree protocol.

\quickimage{RTel/Cap3-020.png}{.5}


\quickimage{RTel/Cap3-019.png}{.5}


\bb{PBB-TE is a technology that can be used in the transport network. It uses only Ethernet but has a lot of overhead to }



\subsubsection{Data Centres}
Big Ethernet Networks where an organization stores, manages and disseminates data. 10 and 100 GbE is used. VLAN aware, PB and PBB are possible to be found in Data Centres. Then there are Servers and Routers (IP and MPLS).

The connection between datacentres is called inter-datacentre connection and sometimes the data-rate needs to be so big that 


There a switch on top of each rack to connect all of the servers. 
\quickimage{RTel/Cap3-022.png}{.5}


Top of Rack (ToR) switch, are connected to aggregation switches connected to just a couple of central switches and these are connected to Edge IP/MPLS routers that connect the IP/MPLS network that is on top of the global transport network.

\quickimage{RTel/Cap3-023.png}{.3}

For instances, to use a cloud based service a virtual machine must be created in one of those servers.


A tree physical topology despite being easy to implement provides no fault tolerance, leads to congestion (no load balancing) and doesn't scale properly since the maximum data rate the central node can handle will limit the size of the tree.

\quickimage{RTel/Cap3-025.png}{.5}


Instead, a Fat Tree is used.
\quickimage{RTel/Cap3-024.png}{.5}

Note that:
\begin{itemize}
    \item Each ToR switch is connected to all aggregation switches for redundancy;
    \item Each aggregation switch should be connected to more than one core/central switch to achieve redundancy and flexible load balancing;
    \item It usually comes 40Gbps from the rack but the switch only outputs 20Gbps, this is quite normal since the traffic is bursty. Overprovisioning would be to have the same output as the input. 
\end{itemize}




A general overview of IPTV network:



\quickimage{RTel/Cap3-027.png}{.3}



DOCSIS Modem is used for HFC, there's FTTx (Fibre to the x, where x can Node, Curb, Building or Home, depending on how close the fibre is terminated) and xDSL (x Digital Subscriber Line).


\quickimage{RTel/Cap3-026.png}{.5}


The final is node in our homes in the set-top box (STB). Contains a TV-tuner input, display output for the television. Also contains, external source signal to receive the data from a cable, satellite or even other ways.




\subsection{SDH - Synchronous Digital Hierarchy}


SDH is not used very much, OTN is the current standard. MPLS-TP is yet another way of doing transport, using MPLS with Transport Profile.

To have deterministic links, the Management plane has to establish them.

There are multiple ways of doing multiplexing. In SDH (and in OTN), TDM is used.

To transmit our signal in SDH using TDM, it will have a slight overhead with the Start Frame Delimiter (SDM). There are many flavours of TDM. However, in a deterministic network, the timeslots are assigned in a fixed way. Therefore, even if one of the input channels doesn't have information to transmit, there will be a slot assigned to it and will be empty.

\quickimage{RTel/Cap4-003.png}{0.6}

Two clocks are synchronous if they operate with the same frequency
and a constant phase offset ($\bigtriangleup \phi(t) = const.$). Moreover, they can be classified with other words regarding the similarities between frequencies and phases.
\quickimage{RTel/Cap4-004.png}{0.6}

Regarding the accuracy of the frequency of the real clock ($f_r$), expressing in Parts Per Million (ppm):

\quickimage{RTel/Cap4-002.png}{0.6}


\bb{A curiosity:} nowadays is possible to find atomic clocks for less than 5k euros. Some as low as 1500 euros.


Because the sampling rate should be at least twice the maximum frequency of the signal to sample it properly (according to the Nyquist Theorem). Therefore:
\quickimage{RTel/Cap4-005.png}{0.6}

\quickimage{RTel/Cap4-006.png}{0.6}





Recalling the meaning of Synchronous and Plesiochronous, now is possible to understand
what are the Digital Hierarchies based on these types of synchrony. In the first (SDH), both ends are synchronized with a central clock while the second (PDH) doesn't require this synchronization. 


In the PDH network, the frequencies are similar and depending on the multiplexing factor, they can drift a certain amount. If the amount of signals being multiplexed grows considerably, 
\quickimage{RTel/Cap4-007.png}{0.6}

For some reasons, the American and the Japanese networks follow slightly different standards, having different amounts of multiplexed channels.

\bb{Note} also



But these PDH still use TDM? Maybe the drift in frequency is small enough to still allow it.





In SDH, the network operator has to provide the synchronization clock, the \bb{PRC - Primary Reference Clock}.

Note that a synchronization network is required to keep all elements with the same clock. Examples of synchronous  networks:
\begin{itemize}
    \item SDH
    \item TDT - Terrestrial Digital Television
    \item GPON - Gigabit Passive Optical Networks is Synchronous as well. (OTN is not)
    \item Mobile Network
    \item PSTN 
\end{itemize}

Regarding SDN then, one of the first proposals was called SONET (Synchronous Optical Network). SDN was later defined by ITU-T as an international standard compatible with SONET. TDM frames were used. Some more nomenclature:

\quickimage{RTel/Cap4-008.png}{0.6}

\quickimage{RTel/Cap4-009.png}{0.6}


\bb{Note}: SDH is compatible with PDH E-n signals. Since SDH is able to carry more information in each TDM frame, it can carry PDH hierarchies in its frames.

\vspace{.5cm}
A SHD basic frame (STM-1) contains 3 blocks:
\begin{itemize}
    \item SOH - Section OverHead for regenerations and multiplexing
    \item PT - Pointer to the Virtual Container start.
    \item VC - Virtual Container with the payload and the 
\end{itemize}


Since this basic frame is sent every 125 micro seconds, 8000 frames per second is the frame rate. Note again that 155 MB/s is the bitrate. 


\quickimage{RTel/Cap4-010.png}{0.6}




Some equipment that is necessary in this kinds of networks:

-An ADM (Add and Drop Multiplexer) selects one of the containers in the TDM frame to drop and one of its own to add, in case it is expecting containers or has containers to send, respectively;

- A regenerator;

- A Terminal Multiplexer (TM) that multiplexes any amount of signals at the entrance to one signal at the output.

- A Digital Cross-Connect (DXC) is able to connect any input to any output, and is controlled by the management plane to establish the previously mentioned semi-permanent paths.

\quickimage{RTel/Cap4-011.png}{0.6}

\quickimage{RTel/Cap4-012.png}{0.6}


These equipments are used in accordance to the densification we have in the network. Closer to the core there are more DXCs, closer to the access there's more ADMs.
\quickimage{RTel/Cap4-013.png}{0.6}


\bb{When we mention ``containers''} we are referring to Ethernet frames or other hierarchies of digital flows.

%check 169 and the control vs management plane stuff...





The transport Network SDH based can be divided in 2 parts, the Path and the Transmission.


\quickimage{RTel/Cap4-014.png}{0.4}

This layers have important functionalities. Path layer functionalities are related with the connections, the paths established. High and Low order ......\dots

These functions are why it is worth it to have extra overhead in all layers:
\quickimage{RTel/Cap4-015.png}{0.5}

Note that these layers are similar to the OSI model layers, each of them has an overhead related to its \ii{modus operandi}, exactly like there are IP headers and MAC headers:
\quickimage{RTel/Cap4-017.png}{0.6}
\quickimage{RTel/Cap4-016.png}{0.6}


Note the scopes in a digital transmission! All of them do regeneration, but not all of them multiplex. In the multiplexing layer its where the clock synchronization comes in, note that despite being able to carry Plesiochronous DH frames, it this is a synchronous hierarchy, so it needs a PRC (primary reference clock).


To step back a bit:
\begin{enumerate}
    \item An SDH basic frame (STM-1) contains section overhead (SOH), PT (pointer) to the beginning of the virtual container with the payload data and then the VC. 
    \item \bb{One STM-1 frame supports 63 E1 frames, 3 E3 or 1 E4}
    \item SOH has a regeneration section and a multiplexing section overheads.
    \item A VC is a container with a path overhead:
    ``The STM-1 frame is 
    represented as a matrix of
    bytes, with 9 rows and 270
    columns, which corresponds
    to 2430 bytes.
    The bytes of the matrix are
    transmitted row by row, left to
    the right.'' - That is why there's a 9 segment separation over the transmission interval, because the frame has 9 rows and each row is transmitted 
    \quickimage{RTel/Cap4-018.png}{0.8}

    \item In a VC there may be several containers + path-overhead
    \item There it takes 125 microseconds to transmit a complete frame, therefore 8000 frames can be transmitted per second.
    \item One payload byte corresponds to 64 kb/s because 8000 of those bytes will be 
    sent per second. Therefore, to know the bitrate of a certain portion of the frame we just need to count the number of bytes and multiply it by 64kbps.
    \item The pointer part of the section points to all container beginnings in the virtual container?
    \item The Frame Alignment Signal sinalizes the beginning of the frame. Despite 
    \item The SOH format is:
    \quickimage{RTel/Cap4-019.png}{0.6}

    Note that there are 3 bytes in a frame to transmit Management plane information regarding the Regeneration. D4-12 are the correspondent for Multiplexing.
    B's are for error corrections for both those planes.
    
    \item There are multiple Virtual containers sizes, all 9 rows long:
        \begin{itemize}
            \item VC-4 - 261 columns long (1 path overhead, 260 C4 payload)
            \item VC-3 - 86 columns long (1 path overhead, 85 C3 payload)
        \end{itemize}
    \bb{Note: In a Virtual Container is possible to carry 1 VC-4 or 3 VC-3s}

    \item A VC-4 with a pointer is called an AU-4. A VC-3 with a pointer is called an AU-3. A frame may have 1 AU-4 or 3 AU-3.
    \item The VC-4 can fluctuate inside the AU-4, it doesn't need to start in the beginning. The same of VC-3. If it doesn't start in the beginning, it can simply continue to other frames.
    \item Overall:
    \quickimage{RTel/Cap4-020.png}{0.7}
\end{enumerate}


AUG aggregates all AUs. If AU-4 is used, then AUG is AU-4, else, it includes more than one AU.


Management plane uses a DCC (Data Communication Channel) which has bytes in the frame overhead, more specifically, D1 to D12 bytes.

Control plane uses B types of bytes.

However, S type of bytes are of the responsibility of the data plane since synchronism is nothing more than expecting bits at certain times.

\subsubsection*{GFP }
\bb{Generic Framic Procedure}(GFP) is an ITU-T standard on how to map packet traffic like Ethernet and SAN (see ahead), which is of bursty nature, \ul{into SDH and OTN with a constant bit rate}.


GFP client frames:
\quickimage{RTel/Cap4-023.png}{0.6}

Other type of GFP frames are GFP control frames, where only the header is sent.




\subsubsection*{Storage Area Networks}
A very redundant server and disk access network, stores information for a big quantity of data. Each server is connected to more than one switch and each switch aggregates more than 2 disk/storage arrays.


One of the most common SAN protocols are Fibre Channels that range from 1 to 128 Gbit per second.





\subsubsection*{Virtual Concatenation}

How is SDH able to cope with 1GbE?
It uses virtual concatenation: creates \bb{X} output flows with STM-1 frames. 
This is called inverse multiplexing.

\quickimage{RTel/Cap4-021.png}{0.7}

Therefore, with $X = 256$, is possible to achieve $256 x 150 Mbit/s = 38.4 Gbit/s$.


This technique can also be used to do balancing in the network since it implements multipath routing on the physical level since the $X$ SDH flows may not do the same path.

There's a field called H4 that has the sequence number of these containers.
8 bits are able to index 256 containers, that is why $X$ is limiter to 256.

\quickimage{RTel/Cap4-022.png}{0.7}


\subsubsection*{IP over SDH / OTN / WDM}

Note that in order to use SDH, a synchronous 
MPLS is one of the important ones. But be aware that MPLS, SDH and OTN are in different planes!

\quickimage{RTel/Cap4-024.png}{0.6}


In summary:
\begin{itemize}
    \item MPLS,  VLANs and directly IP use Ethernet which needs GFP to convert this non constant bit rate traffic to the constant bit rate of SDH; 
    \item SAN and DVB are also supported by GFP (GFP-F and GFP-T)
    As a curiosity:
    \quickimage{RTel/Cap4-025.png}{0.7}
    \item DVB transmits without compression?
    FHD = 1920 x 1080 = 2073600
    QHD = 2560 x 1440 = 3686400
    UHD = 3840 x 2160 = 8294400 (4 times as much as FHD)
    If we have 24 bit color depth, 8 bits per color, we would uncompressed bit rates above 1Gbit/s for FHD at 30 fps. With compression we get around 10 Mbit/s.


    DVB includes Satellite, Cable, Microwave Links portabilities.
\end{itemize}





\subsubsection*{Generalization of Network Element}

MultiService Provisioning Platform

\quickimage{RTel/Cap4-025.png}{0.6}

%194 was the last slide we've seen...





\subsection{OTN - Optical Transport Network}

These can be of 3 types: opaque, transparent or translucent.

Opaque: Electrical nodes, optical links.
Transparent: Optical nodes, optical links.
Translucent: Some nodes are optical, some are electric, optical links.
Nodes are ODU switches. Depending on the type of network (opaque, transparent or translucent), these switches can have line cards at the entrance (equipments that transform the optical signal to the electrical domain) or work fully in the optical domain.


\quickimage{RTel/Cap5-006.png}{0.6}

Note the distinction between optical repeater (represented slightly below) and a regenerator. Regenerator receives the signal and sends it again, i.e the signal passes through the electrical domain. Such thing doesn't happen in transparent networks where everything is optical.


Every 80-120 kilometers an optical amplifier is needed. It belongs to the link.


An optical Line Amplifier has to compensate dispersion and amplify the signal.
EDFA: Erbium-Doped Fiber Amplifier have an automatic gain control to keep power constant at their outputs.

\quickimage{RTel/Cap5-007.png}{0.6}

There's a signal sent in a different wavelength that has the infomation about the amplification. This signal is called Opctical Supervisory Channel and is terminated and at the input side of the amplifier and added at the output. It carries software updates and management information. One way of compensating dispersion it to use dispersion compensating fibres and make the signal propagate there. Fibres that may have higher attenuation but that make the pulses closer together.

\bb{There are 3 main network components:}
\begin{itemize}
    \item Optical Amplifier;
    \item Optical Terminal Multiplexer
    \quickimage{RTel/Cap5-008.png}{0.6}
    \item ROADM (Reconfigurable Optical Add \& Drop Multiplexer) - can have degree 2 or more (up to 8 or 9 nowadays) and must always have a conection to the client, normally connected to IP/MPLS routers, SAN switches, SDH networks, or overall GFM data;
    \item Optical Cross-Connect (OXC) - not very used since multidegree ROADMs are a thing.
\end{itemize}

The same way SDH networks have Regenerators, Terminal multiplexers, ADMs and DXCs, OTN has Optical Amplifiers, Optical Terminal Multiplexers, ROADMs and OXCs


Optical networks operate between 800 and 1600 nm wavelengths, which are in the infrared region of the spectrum.

1310 to 1550 are particularly used in communications due to low attenuations. 


\subsubsection{OTN as the transport Base - Electical Layer}

MPLS is connected to the optical equipment with Ethernet, 10 or 100GbE.
SDH is connected to OTN with SMT-16, STM-64 or STM-256 frames.
SAN is connected with optical channels.

\quickimage{RTel/Cap5-001.png}{0.6}

More generally, OTN can have all clients, it is just a compatibility matter and the standards have that considered.

\quickimage{RTel/Cap5-002.png}{0.6}

\quickimage{RTel/Cap5-003.png}{0.6}

Keep in mind:
\begin{itemize}
    \item 1000Base-SX is 1 Gbps short ranges, 8B/10B code;
    \item CBR means constant bit rate, expected for SDH networks;
    \item The same way SDH is an hierarchy, OTH is also an hierarchy;
    \item In OTH, the first step is in the electrical domain, the second is in the optical domain;
    \item The same way SDH had STM's (STM-4, STM-16, ect\dots), OTH has OTU (Optical Transport Unit, OTU-1, OTU-2, etc\dots);
    \item Client data + OPU header = OPUk - Stuffing, client data type, etc\dots
    OPUK + ODU overhead = ODUK. ODUK + OTU overhead = OTUK:\\
    Optical Payload Unit (equivalent to C-4)  + ODU overhed (equivalent to Path header) - ODUk. The purpose of ODU is to monitor end-to-end performance and do protection switching\\
    Optical Data Unit k + OTU overhead + FEC =  OTUk - Added at the end of the OTUk is added a Forward Error Correction (FEC) field, computed over the ODUk. The OTU overhead has a Frame Alignment Signal (FAS).
    \item All the above mentioned operations take place in the electrical domain. Now is possible to go to the optical domain!
    \quickimage{RTel/Cap5-004.png}{0.6}
    \item Note that ODU2/OTU2 has 4 times the bitrate of ODU1/OTU1. ODU3/OTU3 has 4 times the bitrate of ODU2/OTU2 and 16 times the bitrate of ODU1/OTU1. There also is ODU0 which has half the bitrate of ODU1. Because there isn't any OTU0, 2 ODU0 must be places in ODU1 which is then place in a OTU1. For ODU3 or ODU4, the ration isn't the same and we should check the image. 
    \item Having an ODU-k, the direct solution is to use OTU-k. But there are higher order solutions as well: to aggregate several ODU-k into OTU-k+1 or OTU-k+2, etc\dots We do this aggregation.
    \item The structure of the frame is always the same, what changes is the frame duration. For an higher k, the frames are sent faster.
    \quickimage{RTel/Cap5-005.png}{0.6}
    OTUk bitrates can be calculated in the same way as in SDH: number of bit/bytes in a frame divided by the frame duration.
    \item Note that OTN is a plesiochronous network, because frame durations are not constant. 
    \item The Error correcting code is able to correct at most 16 wrong bytes in a row. 255-238 ....???
\end{itemize}







Overall, the OTN has an hierarchy called OTH. This OTH has two layers, electrical and optical. The electrical layer has 3 layers, OPU, ODU and OTU. Each subsequent layer adds headers to the previous ones. OPU is OPU-header + client payload. ODU is ODU-header + OPU. OTU = OTU-header + ODU + FEC, where FEC is calculated over the ODU to check for errors.

OTU-k, for k from 1 to 5, has the following bitrates: OTU-1 supports 2.5 Gbit/s, OTU-2 supports 10Gb/s, OTU-3 supports 40Gb/s, OTU-4 supports 100 Gb/s and OTU-5 supports 400Gb/s.

The OTU frame is a TDM frame. OTN is a non-synchronous network, called a plesiochronous network. In a synchronous network, the clock information is propagated from a master. In plesiochronous network there's no clock information, only tools for synchronization. In optical networks is very difficult to have the complete synchrony. In the electrical part is possible and they function in an autonomous. 

Another very good way of knowing if a network is synchronous or plesiochronous, is by the frame duration. In SDH every frame lasts 125 microseconds while in OTN, different frames types (k order) have different durations.



\subsubsection{Optical layer}

In an Ethernet network is possible to use optical fibres, however in OTN the fibres are used with much higher data rates, therefore there are different wavelengths:
1310nm and 1550nm are the most common. With these wavelengths, single mode fibres are possible.

1310 nm (0-band with 100nm of length, correspondent to 17.48 THz of bandwidth) are more used in datacentres, because the distances are not that high and 1550 nm is used in OTN. 1550 nm has 0.18 dB/km, the physical limit is 0.16 dB/km.


With the OTK-k frame, that bitrate is passed through a laser-diode that emits radiation in the visible spectrum, in a given wavelength. This signal is converter to an optical channel.

A \bb{Transponder} will take the client data, create OPU, ODU, OTU and generate an Optical Channel.

A quick example: what would be the block diagram for sending 10 GBASE-R signals? These signals can only use ODU2e ODUs, and 10 of them only fit in one ODU4. In theory, it would also be possible to place them in 4 ODU3.  Therefore, there would have to be a parallelisation until the OTU4 multiplexing and only one ODU4 would be converted to an optical channel.

Muxponder is a transponder that also multiplexes. A muxponder has several clients when a transponder has only one. 

Since outputting light is the expensive part (note that a process in the electrical domain as already used in Ethernet), the price per client is smaller if they share a muxponder.


DWDM means Dense WDM, which is when many wavelengths are used. WDM term is used when the amount of wavelengths is around or smaller than 16.

To the people that have fibre to the home (FTTH), each home will have a multimode (cheap) fibre that takes the traffic to a multiplexer at the building, and another at a street level. After these, DWDM is done. Also, remember that the terminal multiplexer is always degree 1. It only matter how many of the actual connections to the network it has.


In SDH, degree 2 equipments were called ADM (Add \& Drop Multiplexers). In OTN it's OADM to allow frames to be droped and added (on the side that is connected to the clients). Because it is connected to the transport fibre on 2 sides (in \& out), it has degree 2.

ROADM is used, the R is for Reconfigurable and the reconfigurable part is the possible wavelength of use.


There are 3 optic layers:
\quickimage{RTel/Cap5-009.png}{0.6}

\quickimage{RTel/Cap5-010.png}{0.6}

At the end, an Optical Transport Module n.m is generated. n = number of optical channels m = k, for the OTU-k. If m = 0 is because there's a mix of bit rates.






\subsubsection{Routing and Wavelength Assignment}
Route according to the traffic demands, obtain the lightpahts and then choose the wavelengths to be used in each lightpath.


The routing problem is known from other networks. The Wavelength assignment has some rules:
\begin{itemize}
    \item Wavelength Continuity - All the links of a lightpath must be the same wavelength;
    \item Distinct Wavelengths - All the lightpaths that traverse the same link must have different wavelengths.
\end{itemize}

This is common sense, but in a pool of wavelengths, how to choose?

Dynamic Wavelength assignment strategies:
\begin{itemize}
    \item First Fit - Choose the first that fits. There are a couple of paths, check which is the lowest wavelength available (not necessarily the shortest wavelength, the wavelength with the lowest index, there's an abstraction) and assign that one.
    \item Most used - 
    \item Longest First - 
\end{itemize}

In Dynamic wavelength assignment, the wavelength is assigned as the demands come. 
In Static WA, we can simple order the demands according to shortest first, longest first, largest first or random and do the same thing as in Dynamic but considering that the new order is the order of arrival.




\subsection{Access Network}
\subsubsection{Intro}
The networks that allow the connection of the client with the operator.

This is the simplest yet the most expensive part of the network.

Regarding the Public Switched Telephone Network.

\quickimage{RTel/Cap6-001.png}{0.6}


The Main distribution frame will connect the different pairs of Simetric twisted copper cables (200 or more cables), reaching the SDC it will be divided in groups of 30-50. And reaching the Drop Point it gets divided to unity, one for each client.

If we want to replace the feeder cable that has hunders of twister pairs by a fibre one has two options:
\begin{itemize}
    \item since the fibre as much wider band that the twisted pair, one option would be to put the signal of each pair in a wavelengt. However, WDM is very expensive and one wavelength would still be too much for a copper cable. 
    \item In order to avoid WDM, one can simply use one wavelength as multiplex in the time domain, TDM with 200 slots. Here we can't use statistical multiplexing because here is done circuit switch and the flow is given by the timeslot where it arrives. However, if we 
\end{itemize}

Replacing the feeder cable by an optic fibre, is necessary to multiplex / demultiplex and convert to/from the optic domain. Note that we need one optic fibre per direction. Here the SDC are called Remote Units.

Because all the channels are not used at the same time, exceptionnaly in the new year's eve, less channels (K of them) can be used without a problem. $\frac{N}{K}$ is the concentration factor. In an image:

\quickimage{RTel/Cap6-002.png}{0.6}


A redundant way of connecting Central Offices and RU's can be a mesh or rings.

\quickimage{RTel/Cap6-003.png}{0.6}


A few years ago, in order to use these copper cables to access the internet, one could modulate an internet signal in the copper cable. By using a Digital Subscribel Line (DSL) Modem (Modulator Demodulator), taking advantage of 4 kHz band, used for voice, one can get 56 kbit/s. Internet access and voice go in the same cable in different frequencies.

In the Central Office, the DSL Access Multiplexer (DSLAM) is connected to internet, at the time using Ethernet.

\quickimage{RTel/Cap6-004.png}{0.6}



The DSLAM connects to an aggregation network, more specifically, to a PB switch.
Also, VLANs are used to identify different services.

\quickimage{RTel/Cap6-006.png}{0.6}




Different types of duplexing are done in the copper cable.
Echo Cancelation Duplexing is based on the cancelation of echos through the generation of similar signals and doing their difference. Echos happen due to impedances mismatches. $\hat{r}(t)$ is created and will try to nullify the echo of $y(t)$.

\quickimage{RTel/Cap6-005.png}{0.6}



\subsubsection{Copper vs Fibre}
The conventional access network is the network described so far, the one used in the PSTN. However, copper twisted pairs can still be used for internet access. When this is the case, technologies that use twisted pair for internet access use the DSL (Digital Subscriber Line). DSL is the name technologies that use the telephone line have. Obviously, nowadays it is used much more than just for telephone and it that cable dangling of 2 posts. Because it uses copper pairs, it is very cheap.

Nowadays, VDSL, ADSL2+ and ASDL are the main technologies over the DSL.
\quickimage{RTel/Cap6-009.png}{0.6}


The main problem with copper cables is the range. In copper there are severe problems with attenuation therefore the code is very limited. The bitrate is a direct function of the distance.

In fibres the problem has more to do with dispersion and are capable of getting much further. That and the huge bandwidth is why they are replacing copper almost everywhere.


In ADSL and posterior copper technologies, the DSL Access Multiplexer (DSLAM) is responsible for the aggregation along with PB Switches. Between the access and the metro networks there is always an aggreagtion layer.

The image below is quite important. It shows how a triple play network is completely connected. In essence, the television is connected to a set-top box, which is used to retrive the tv signal from the modulation. Sometimes from the cable, sometimes from the over-the-air sometimes even from a satellite. Nowadays it only decodes IPTV video stream. All the remaining client devices, phones, laptops (\dots) are connected to an Home Gateway which is also a router and an wi-fi access point. The HG is connected to a Modem (in case of ADSL) that will perform the modulation and demodulation. 

\quickimage{RTel/Cap6-011.png}{0.6}

Clearly, from the picture as well, there must be a Network Access Provider that guarantees the connection between the Service Suppliers (IPTV platform, VOIP platform and Internet given by an ISP).

Something important is to know how the flows are separated at a client level, at a service level and at a DSLAM level, because the ethernet frames must reach the correct DSLAMs. For this, VLANs are used with 2 distinct tags, C-tag and S-tag. The C-tag (client) has information about the client and the type of flow/service the client is requiring. The S-tag (Service), despite the name, refers to the DSLAM where that client is connected. These tags will be read by the PB Ethernet Switch.



\subsubsection*{The change to fibre}
We've said before that it can be done at a feeder level. But it can and is being done at distribution network! It has to use a P2MP (Point to Multipoint) connection in order to save costs in fibre. 

The equipment that performs the aggregation of many fibres and that is equivalent to a DSLAM in functionality is the Optical Line Terminal (OLT).

\quickimage{RTel/Cap6-012.png}{0.6}

It is connected to a ONU or a ONT, depending on how far the fibre reaches into the home of the client.

\quickimage{RTel/Cap6-013.png}{0.6}

If the fibre reaches the building or even the Home, it is called an ONT. Else, if it reaches only the concentrator, cabinet or curb, the node that transforms it to the electrical domain is the ONU.



\subsubsection{Fibre: Active vs Passive}

\quickimage{RTel/Cap6-010.png}{0.6}

We work with the passive. Active would be something like normal ethernet switches. However, those are hard to power.

Therefore, Passive Optical Networks (PON) are whats most widely used.

A key element in a PON is the splitter. With directional couplers it reproduces in every exit the same as the entrance but with a fraction of the power.


\quickimage{RTel/Cap6-014.png}{0.6}

Additionally, there are different multiple access PONs. In the OLT stuff needs to join to get into the same feeder. 

\quickimage{RTel/Cap6-015.png}{0.6}


Of these 2 types, TDM-PON is the most used. WDM-PON is probably just used in Korea..

\quickimage{RTel/Cap6-016.png}{0.6}




\subsubsection{Passive: EPON vs GPON}
A summary right at the beginning:
\quickimage{RTel/Cap6-017.png}{0.6}

\subsubsection*{EPON}
Ethernet over PON, basically.

EPON frames are like:
\quickimage{RTel/Cap6-007.png}{0.6}

This way, is possible to identify to whom the frame is for. These frames are sent from the OLT to the spliter and only at the ONU the frames are filtered for the correct user.

The LLID is the field responsible for this, is used for the extraction.

\bb{Downstream:}
\quickimage{RTel/Cap6-008.png}{0.6}

\bb{Upstream:}
\quickimage{RTel/Cap6-021.png}{0.6}


EPON has a symmetric rate (down/upstream) of 1.25 Gbaud which results in a 1Gib/s bit rate when using the 8B10B coding scheme.

To upstream, each ONU is allocated a time-slot and several ethernet frames fit in that timeslot. A complete time-slot cycle over all ONUs has 1 ms. And the guard interval has 1.5 microseconds. Therefore, it depends on how many ONUs are sharing an OLT. Tipically, 16 users share a OLT. $1ms = 16 \times$(ethernet-frame + guard-interval). Thus, one gets 61 microseconds of ethernet frame duration, which, at 1Gbit/s are 61 000 ethernet frames. Of course, the efficiency is not 100\% due to error correction codes mainly.



A few final notes about EPON frame format:
\begin{itemize}
    \item There are LLIDs which stand for Logical Link Identifiers. From the name is possible to understand that the links are logical. They not only identify each client but also each service. Therefore, over the same physical link going from an OLT to a certain client's ONU there can be 3 logical links connecting the service in the client's home to the service provider (tv, voice or data).
    \item The ONU knows what LLID's came from him and rejects all others; But, how about the VLANs? Does the ONU map between VLANs and LLIDs? \bb{YES}. 
    If there are no Ethernet frames, the ONU transmits only 10 meaningless bytes?
    \bb{OLT Functions in EPON}
    \quickimage{RTel/Cap6-018.png}{0.6}

    Depending on the buffer occupancy, the frames can be longer or shorter. The ONU reports this occupancy with... (guess what) a \bb{report}. The OLT sends a \bb{gate} to each ONU and this is the \ul{bandwidth assignment process}.
    
    \bb{The control plane is the responsible for this and all other OLT functions described above.} Tip: to have a complete answer regarding the control plane, 
    \item The duration of each time slot is called the transmission window and this window size is what will be attributed to an ONU. The windows size is the number of bytes that can be transmitted. Therefore, to get the slot duration, one simply does $\frac{8 \times \text{Windown}}{\text{Datarate}}$. Additionally, there's a guard interval.
    \item It is called a cycle time for the set of N time-slots. N corresponds to the number of ONUs. For EPON, this value is typically 16. \bb{The number of time slots is equal to the number of ONUs connected to the OLT because in a cycle everyone needs the oportunity to transmit}. A cycle time is nothing more than the sum of each time slot duration + guard time:
    \quickimage{RTel/Cap6-019.png}{0.6}
\end{itemize}

\subsubsection*{GPON}

GPON has around 2.5 downstream and 1.25 upstream.



slides 297 and 298 mainly. 



Frame summary: slide 300

XGPON through faster electronic is able to increase the bitrates per wavelength to 10 Gbit/s.
TWDM-PON does $4 \times 10$ downstream and $4 \times 2.5$ upstream.
\quickimage{RTel/Cap6-020.png}{0.5}

There are two main limitations with increasing the bit rate in optical fibre. Problems with fast electronics and dispersion. The narrower the pulse, the more bandwidth it takes and thus the higher the dispersion. Then it starts to get really expensive and this is only access..

Network operators assume only about 40 \% of the users use the resources at the same time.


In GPON, the bottom two layers are GTC and PHY while in the EPON was MAC and PHY.
\quickimage{RTel/Cap6-023.png}{0.6}


GPON Encapsulation Methods is one of the functionalities of GPON Transmission Convergence Layer in the GPON network.

GEM header has several functionalities like having the FAS (Frame Alignment Sequence)


P-ID in the GEM header, payload is an ethernet frame

While in EPON the downstream ethernet frames are transmitted \ii{raw}, in GPON networks the P-ID is 

\quickimage{RTel/Cap6-022.png}{0.65}

Upstream, the ethernet frames are placed inside GEM frames and those go into a T-container (transmission container). 
Inside the GEM frames is possible to transport different types of frames : Ethernet, ATM, etc..
Depending on the required Qos of the traffic, different T-containers can be used: Different T-containers are meat to separate traffic types by the QoS (VoIP is different than IPTV).
Each T-container has a \bb{alloc-ID}. The alloc-ID tells the OLT from where the T-container came from. There can be multiple frames of that traffic in each T-container.

Only in the upstream, T-containers are used. Both is upstream and downstream, GTC frames are used. however in upstream they have many headers + t containers + guardband while in the downstream they simple are a bunch of GEMs together that each ONU will remove the one that has it's P-ID.


In the EPON, the dynamic bandwidth allocation Gate and Report messages are used and this reduces the efficiency of the network. In GPON these messages are included in the header GTC, there aren't specific separated messages simply for these reports.


Splitting ratio in the number of ONUs connected to a OLT.


\subsubsection{XGPON, TWDM-PON and WDM-PON}

TWDM-PON is able to serve much higher bitrates but to far fewer users since they need $2N$ wavelengths to serve up and downstream N users.


WDM-PONs are GOOD because are very future proof. If each user has it's wavelength (and each wavelength has a bandwidth of 50 GHz) it is possible to increase the bitrates until something like 40Gbit per user, which is still slightly out of range of today's technology. With this network structure is possible to increase everyone's bitrates by simply changing the OLT.

\quickimage{RTel/Cap6-024.png}{0.6}


\subsubsection{todo}
\begin{comment}
    do the maths for the bitrate in a fibre - ethernet
\end{comment}